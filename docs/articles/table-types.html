<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Radlibrary table types • Radlibrary</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Radlibrary table types">
<meta property="og:description" content="Radlibrary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Radlibrary</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Radlibrary.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/table-types.html">Radlibrary table types</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/facebookresearch/Radlibrary/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="table-types_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Radlibrary table types</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/facebookresearch/Radlibrary/blob/master/vignettes/table-types.Rmd"><code>vignettes/table-types.Rmd</code></a></small>
      <div class="hidden name"><code>table-types.Rmd</code></div>

    </div>

    
    
<p>The Ad Library provides data ads such as when they ran, how much money was spent on them, where were they seen, and who saw them. This data is not always convenient to display all in a single table. <code>Radlibrary</code> provides an interface for converting the data provided by the API into a <a href="https://r4ds.had.co.nz/tidy-data.html">tidily formatted</a> <code>tibble</code>. There are three types of tables that can <code>Radlibrary</code> can build. This vignette shows how to obtain the data for each type and construct the corresponding tables.</p>
<div id="ad-tables" class="section level1">
<h1 class="hasAnchor">
<a href="#ad-tables" class="anchor"></a>Ad Tables</h1>
<p>Ad tables are tables with a single row per ad, and columns representing attributes of each ad. The <code>Radlibrary</code> defaults are set to make the creation of ad tables easy. To obtain the data for an ad table, start by building a query and setting the <code>fields</code> to <code>ad_data</code>. Below we construct query to build an ad table for all ads that had impressions in the US yesterday and contain the search term “medicare”.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://facebookresearch.github.io/Radlibrary/">Radlibrary</a></span><span class="op">)</span>
<span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adlib_build_query.html">adlib_build_query</a></span><span class="op">(</span>
  ad_reached_countries <span class="op">=</span> <span class="st">"US"</span>,
  search_terms <span class="op">=</span> <span class="st">"medicare"</span>,
  impression_condition <span class="op">=</span> <span class="st">"HAS_IMPRESSIONS_YESTERDAY"</span>,
  fields <span class="op">=</span> <span class="st">"ad_data"</span>
<span class="op">)</span>

<span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adlib_get.html">adlib_get</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span>
<span class="va">response</span>
<span class="co">#&gt; Data response object with 1000 entries.</span></code></pre></div>
<p>The response object can be converted to a table with <code>as_tibble</code>. We will specify that we want an <code>ad_table</code> out of <code>as_tibble</code> (although we don’t have to, because that’s the default).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ad_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">response</span>, type <span class="op">=</span> <span class="st">'ad'</span>, censor_access_token <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">ad_table</span>
<span class="co">#&gt; # A tibble: 1,000 x 17</span>
<span class="co">#&gt;    ad_creation_time    ad_creative_body ad_creative_lin… ad_creative_lin…</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;           </span>
<span class="co">#&gt;  1 2019-12-10 15:06:54 Polling numbers… www.wearemitu.c… "   "           </span>
<span class="co">#&gt;  2 2019-12-10 15:06:50 Polling numbers… www.wearemitu.c… "   "           </span>
<span class="co">#&gt;  3 2019-12-10 15:06:46 Polling numbers… www.wearemitu.c… "   "           </span>
<span class="co">#&gt;  4 2019-12-10 23:36:46 I helped pass l… fb.me            Everyone should…</span>
<span class="co">#&gt;  5 2019-12-10 23:36:46 Nobody should h… fb.me            Everyone should…</span>
<span class="co">#&gt;  6 2019-12-10 23:36:42 Nobody should h… fb.me            Everyone should…</span>
<span class="co">#&gt;  7 2019-12-10 23:36:31 Nobody should h… fb.me            Everyone should…</span>
<span class="co">#&gt;  8 2019-12-10 23:36:27 I helped pass l… fb.me            Everyone should…</span>
<span class="co">#&gt;  9 2019-12-10 23:36:27 Nobody should h… fb.me            Everyone should…</span>
<span class="co">#&gt; 10 2019-12-10 23:36:12 I helped pass l… fb.me            Everyone should…</span>
<span class="co">#&gt; # … with 990 more rows, and 13 more variables: ad_creative_link_title &lt;chr&gt;,</span>
<span class="co">#&gt; #   ad_delivery_start_time &lt;dttm&gt;, ad_delivery_stop_time &lt;dttm&gt;,</span>
<span class="co">#&gt; #   currency &lt;chr&gt;, funding_entity &lt;chr&gt;, page_id &lt;chr&gt;, page_name &lt;chr&gt;,</span>
<span class="co">#&gt; #   spend_lower &lt;dbl&gt;, spend_upper &lt;dbl&gt;, adlib_id &lt;chr&gt;,</span>
<span class="co">#&gt; #   impressions_lower &lt;dbl&gt;, impressions_upper &lt;dbl&gt;, ad_snapshot_url &lt;chr&gt;</span></code></pre></div>
<p>The <code>adlib_id</code> column can act as a primary key for this table. It is a unique identifier for each ad within the context of the Ad Library. This will come in handy for joins with the other table types.</p>
</div>
<div id="demographic-tables" class="section level1">
<h1 class="hasAnchor">
<a href="#demographic-tables" class="anchor"></a>Demographic tables</h1>
<p>The demographic table provides estimates of the number of impressions that the ad receives by age and gender. There is one row per combination of age bucket, gender, and ad ID. To build this table for this same set of ads, we need to get the right dataset by changing the <code>fields</code> argument in the query.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">demo_query</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adlib_build_query.html">adlib_build_query</a></span><span class="op">(</span>
  ad_reached_countries <span class="op">=</span> <span class="st">"US"</span>,
  search_terms <span class="op">=</span> <span class="st">"medicare"</span>,
  impression_condition <span class="op">=</span> <span class="st">"HAS_IMPRESSIONS_YESTERDAY"</span>,
  fields <span class="op">=</span> <span class="st">"demographic_data"</span>
<span class="op">)</span>
<span class="va">demo_response</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adlib_get.html">adlib_get</a></span><span class="op">(</span><span class="va">demo_query</span><span class="op">)</span>
<span class="va">demo_response</span>
<span class="co">#&gt; Data response object with 1000 entries.</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">demo_response</span>, type <span class="op">=</span> <span class="st">'demographic'</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10,847 x 4</span>
<span class="co">#&gt;    percentage age   gender  adlib_id        </span>
<span class="co">#&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;           </span>
<span class="co">#&gt;  1    0.0844  25-34 male    1037628349909689</span>
<span class="co">#&gt;  2    0.00444 18-24 female  1037628349909689</span>
<span class="co">#&gt;  3    0.00444 13-17 unknown 1037628349909689</span>
<span class="co">#&gt;  4    0.00444 35-44 unknown 1037628349909689</span>
<span class="co">#&gt;  5    0.00444 55-64 unknown 1037628349909689</span>
<span class="co">#&gt;  6    0.00889 13-17 male    1037628349909689</span>
<span class="co">#&gt;  7    0.0133  35-44 female  1037628349909689</span>
<span class="co">#&gt;  8    0.00444 13-17 female  1037628349909689</span>
<span class="co">#&gt;  9    0.0133  65+   unknown 1037628349909689</span>
<span class="co">#&gt; 10    0.156   65+   male    1037628349909689</span>
<span class="co">#&gt; # … with 10,837 more rows</span></code></pre></div>
<p>The <code>adlib_id</code> column in this table will match the <code>adlib_id</code> from the ad table so that these can be joined if necessary.</p>
</div>
<div id="region-tables" class="section level1">
<h1 class="hasAnchor">
<a href="#region-tables" class="anchor"></a>Region Tables</h1>
<p>The region table is similar to the demographic table in that it contains a distribution over bucketed values. The data for this table can be retrieved by making a query with <code>"region_data"</code> as the fields.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg_query</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adlib_build_query.html">adlib_build_query</a></span><span class="op">(</span>
  ad_reached_countries <span class="op">=</span> <span class="st">"US"</span>,
  search_terms <span class="op">=</span> <span class="st">"medicare"</span>,
  impression_condition <span class="op">=</span> <span class="st">"HAS_IMPRESSIONS_YESTERDAY"</span>,
  fields <span class="op">=</span> <span class="st">"region_data"</span>
<span class="op">)</span>
<span class="va">reg_response</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adlib_get.html">adlib_get</a></span><span class="op">(</span><span class="va">reg_query</span><span class="op">)</span>
<span class="va">reg_response</span>
<span class="co">#&gt; Data response object with 1000 entries.</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">reg_response</span>, type <span class="op">=</span> <span class="st">'region'</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 18,076 x 3</span>
<span class="co">#&gt;    percentage region         adlib_id        </span>
<span class="co">#&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;           </span>
<span class="co">#&gt;  1    0.0267  Alabama        1037628349909689</span>
<span class="co">#&gt;  2    0.0267  Oklahoma       1037628349909689</span>
<span class="co">#&gt;  3    0.00889 Nebraska       1037628349909689</span>
<span class="co">#&gt;  4    0.00889 New Jersey     1037628349909689</span>
<span class="co">#&gt;  5    0.0178  New Mexico     1037628349909689</span>
<span class="co">#&gt;  6    0.0356  New York       1037628349909689</span>
<span class="co">#&gt;  7    0.0267  North Carolina 1037628349909689</span>
<span class="co">#&gt;  8    0.00889 North Dakota   1037628349909689</span>
<span class="co">#&gt;  9    0.0444  Ohio           1037628349909689</span>
<span class="co">#&gt; 10    0.0267  Oregon         1037628349909689</span>
<span class="co">#&gt; # … with 18,066 more rows</span></code></pre></div>
<p>There is one row per region where an ad was seen, per ad. Again this table contains the identifier column <code>adlib_id</code>, allowing this table to be joined with the others.</p>
</div>
<div id="a-note-on-how-much-data-to-ask-for" class="section level1">
<h1 class="hasAnchor">
<a href="#a-note-on-how-much-data-to-ask-for" class="anchor"></a>A note on how much data to ask for</h1>
<p>It is possible to ask for the data for all of these tables at the same time. The region table can be constructed as long as <code>region_distribution</code> is included as a field in the query, and the demographic table can be constructed as long as <code>demographic_distribution</code> is included as a field. However, specifying all fields at the same time results in very large responses that may time out or exceed the data transfer limit of the API. It is better to make smaller requests for fewer fields, which can be easily joined together later using the <code>adlib_id</code> column.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Colin Fraser, Kyle Shank.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
